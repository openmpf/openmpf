<!--
    NOTICE

    This software (or technical data) was produced for the U.S. Government
    under contract, and is subject to the Rights in Data-General Clause
    52.227-14, Alt. IV (DEC 2007).

    Copyright 2022 The MITRE Corporation. All Rights Reserved.
-->

<!--
    Copyright 2022 The MITRE Corporation

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<div class="page-header text-center">
    <div>
        <h3>Job Status</h3> <page-info>The jobs table will be periodically updated and an alert message will appear when new jobs are COMPLETE.</page-info>
    </div>
    <div ng-if="updateInfoMsg">
        <small class="text-muted"> {{updateInfoMsg}} </small>
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <table id="jobTable" class="table table-bordered table-striped dataTable" role="grid">
            <thead>
            <tr>
                <th>Id</th>
                <th>Pipeline</th>
                <th><i class="fa fa-clock-o" title="Stop"></i> Start Date</th>
                <th><i class="fa fa-clock-o" title="Stop"></i> End Date</th>
                <th>Status <i class="fa fa-info-circle helper-icon" id="infoModalBtn"></i></th>
                <th>TiesDb</th>
                <th>Callback</th>
                <th>Priority</th>
                <th>Actions</th>
            </tr>
            </thead>
        </table>
    </div>
</div>

<div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="infoModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="infoModalLabel">Legend</h4>
            </div>
            <div class="modal-body">
                <div class="list-group text-left">
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-default">CANCELLED</span></h4>
                        <p class="list-group-item-text">Indicates the job was cancelled.</p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-default">CANCELLED_BY_SHUTDOWN</span></h4>
                        <p class="list-group-item-text">Indicates the job was cancelled as a result of a system shutdown.</p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-default">CANCELLING</span></h4>
                        <p class="list-group-item-text">Indicates the job is in the middle of cancellation.</p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-default">COMPLETE</span></h4>
                        <p class="list-group-item-text">Indicates the job has completed. </p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-danger">COMPLETE_WITH_ERRORS</span></h4>
                        <p class="list-group-item-text">Indicates the job has completed, but with processing errors.</p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-warning">COMPLETE_WITH_WARNINGS</span></h4>
                        <p class="list-group-item-text">Indicates the job has completed, but with warnings.</p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-danger">ERROR</span></h4>
                        <p class="list-group-item-text">Indicates the job is in an error state.</p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-default">IN_PROGRESS</span></h4>
                        <p class="list-group-item-text">Indicates the job is in progress.</p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-danger">IN_PROGRESS_ERRORS</span></h4>
                        <p class="list-group-item-text">Indicates the job is in progress with errors.</p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-warning">IN_PROGRESS_WARNINGS</span></h4>
                        <p class="list-group-item-text">Indicates the job is in progress with warnings.</p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-default">INITIALIZED</span></h4>
                        <p class="list-group-item-text">The job has been initialized but not started.</p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-default">RESUBMITTING</span></h4>
                        <p class="list-group-item-text">The job is being resubmitted.</p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading"><span class="label label-primary">UNKNOWN</span></h4>
                        <p class="list-group-item-text">Default: The status of the job is unknown.</p>
                    </a>
                </div>

            </div>
            <div class="modal-footer">
                <div class="pull-right">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="mediaModal" tabindex="-1" role="dialog" aria-labelledby="mediaModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="mediaModalLabel">Media<br/>
                    Job {{selectedJob.jobId}}
                    <small> {{selectedJob.pipelineName}}</small>
                </h4>
            </div>
            <div class="modal-body ">
                <table id="markupsTable" class="table table-bordered table-striped dataTable" role="grid" style="width: 100%;table-layout: auto;">
                    <colgroup>
                        <col style="width: 4%">
                        <col style="width: 4%">
                        <col style="width: 32%">
                        <col style="width: 10%">
                        <col style="width: 4%">
                        <col style="width: 32%">
                        <col style="width: 10%">
                        <col style="width: 4%">
                    </colgroup>
                    <thead>
                        <th>Parent Media Id</th>
                        <th>Media Id</th>
                        <th>Source Preview</th>
                        <th>Source Path</th>
                        <th>Source Actions</th>
                        <th>Markup Preview</th>
                        <th>Markup Path</th>
                        <th>Markup Actions</th>
                    </thead>
                </table>
            </div>
            <div class="modal-footer">
                <div class="pull-right">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="errorDetailsModal" tabindex="-1" role="dialog" aria-labelledby="errorDetailsModalLabel">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="errorDetailsModalLabel">
                    Job {{selectedJob.jobId}} {{errorType}} Error:
                </h4>
            </div>
            <div class="modal-body smart-wrap" style="white-space: pre-line; hyphens: initial">
                {{errorDetails}}
            </div>
            <div class="modal-footer">
                <div class="pull-right">
                    <button ng-if="isRepostableError"
                            ng-click="tiesDbRepost()"
                            ng-disabled="isReposting() || repostWasSuccessful()"
                            ng-class="{'btn-success': repostWasSuccessful(), 'btn-warning': isReposting()}"
                            type="button"
                            class="btn btn-default">

                        <i ng-if="isReposting()" class="fa fa-refresh fa-spin fa-fw"></i>

                        <span ng-if="!isReposting()"> Re-Post </span>

                        <i ng-if="repostWasSuccessful()" class="fa fa-check fa-fw"></i>
                    </button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
